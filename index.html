<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>임베딩된 StackEdit 에디터</title>
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            color: white;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header p {
            margin: 8px 0 0 0;
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px 20px;
        }
        
        .toolbar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn.active {
            background: rgba(255,255,255,0.9);
            color: #667eea;
        }
        
        .editor-container {
            background: rgba(255,255,255,0.98);
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .editor-header {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .editor-status {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .split-view {
            display: flex;
            height: 80vh;
            min-height: 700px;
        }
        
        .source-panel, .stackedit-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .source-panel {
            border-right: 1px solid #e5e7eb;
            background: #fafbfc;
            max-width: 50%;
        }
        
        .stackedit-panel {
            background: white;
            min-width: 50%;
        }
        
        .panel-header {
            padding: 12px 20px;
            font-weight: 600;
            font-size: 13px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .source-header {
            background: #f8f9fa;
            color: #4a5568;
        }
        
        .stackedit-header {
            background: #ffffff;
            color: #4a5568;
        }
        
        .source-textarea {
            flex: 1;
            border: none;
            padding: 20px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 14px;
            line-height: 1.7;
            resize: none;
            outline: none;
            background: #fafbfc;
            color: #2d3748;
        }
        
        .stackedit-iframe-container {
            flex: 1;
            position: relative;
            background: white;
        }
        
        .stackedit-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 10;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .demo-panel {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .demo-files {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .demo-file {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .demo-file:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .info-panel {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-top: 15px;
        }
        
        .info-panel h4 {
            margin: 0 0 8px 0;
            color: #4338ca;
            font-size: 14px;
        }
        
        .info-panel p {
            margin: 0;
            color: #64748b;
            font-size: 13px;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .split-view {
                flex-direction: column;
                height: auto;
            }
            
            .source-panel, .stackedit-panel {
                min-height: 400px;
                max-width: 100%;
                min-width: 100%;
            }
            
            .source-panel {
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .toolbar {
                gap: 5px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📝 임베딩된 StackEdit 에디터</h1>
        <p>페이지에 직접 통합된 실제 StackEdit 에디터</p>
    </div>
    
    <div class="container">
        <div class="toolbar">
            <button class="btn" id="newFileBtn">📄 새 파일</button>
            <button class="btn" id="saveBtn">💾 저장</button>
            <button class="btn" id="exportHtmlBtn">📤 HTML 내보내기</button>
            <button class="btn" id="exportMdBtn">📝 MD 내보내기</button>
            <button class="btn" id="fullscreenBtn">⛶ 전체화면</button>
        </div>
        
        <div class="editor-container">
            <div class="editor-header">
                <div class="editor-title">📝 StackEdit 통합 에디터</div>
                <div class="editor-status" id="editorStatus">
                    <span id="fileName">document.md</span> • 
                    <span id="fileStatus">준비됨</span>
                </div>
            </div>
            
            <div class="split-view">
                <div class="source-panel">
                    <div class="panel-header source-header">
                        📝 마크다운 소스 (실시간 동기화)
                    </div>
                    <textarea id="sourceTextarea" class="source-textarea" placeholder="StackEdit 에디터가 로딩되면 여기에 실시간으로 내용이 동기화됩니다...

에디터 준비 중... 잠시만 기다려주세요!"># 🚀 임베딩된 StackEdit 에디터

이 에디터는 **실제 StackEdit**이 페이지에 직접 임베딩되어 있습니다!

## ✨ 실시간 기능

오른쪽 StackEdit에서 편집하면 왼쪽 소스가 **실시간으로** 업데이트됩니다.

## 🧮 수학 공식
$$E = mc^2$$

인라인 수식도 가능: $\alpha + \beta = \gamma$

## 📊 다이어그램
```mermaid
graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Action 1]  
    B -->|No| D[Action 2]
    C --> E[End]
    D --> E
```

## 📋 표
| 기능 | 상태 | 비고 |
|------|------|------|
| 실시간 동기화 | ✅ | 완벽 |
| KaTeX | ✅ | 모든 기능 |
| Mermaid | ✅ | 모든 다이어그램 |

**이제 오른쪽에서 편집해보세요!** 🎉</textarea>
                </div>
                
                <div class="stackedit-panel">
                    <div class="panel-header stackedit-header">
                        ⚡ StackEdit 에디터 (실시간 편집)
                    </div>
                    <div class="stackedit-iframe-container">
                        <div class="loading-overlay" id="loadingOverlay">
                            <div class="loading-spinner"></div>
                            <p style="margin-top: 15px; color: #64748b;">StackEdit 로딩 중...</p>
                        </div>
                        <!-- StackEdit iframe이 여기에 로딩됩니다 -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-panel">
            <h3 style="color: #4338ca; margin: 0 0 15px 0; text-align: center;">🎯 데모 문서 로드</h3>
            <div class="demo-files">
                <div class="demo-file" data-demo="welcome">🏠 Welcome</div>
                <div class="demo-file" data-demo="math">🧮 수학 공식</div>
                <div class="demo-file" data-demo="diagrams">📊 다이어그램</div>
                <div class="demo-file" data-demo="tables">📋 고급 표</div>
                <div class="demo-file" data-demo="features">✨ 모든 기능</div>
            </div>
            
            <div class="info-panel">
                <h4>💡 사용 방법</h4>
                <p>
                    • 오른쪽 StackEdit 에디터에서 직접 편집하세요<br>
                    • 변경사항이 왼쪽 소스에 실시간으로 반영됩니다<br>
                    • 데모 버튼을 클릭해서 다양한 예제를 체험해보세요<br>
                    • 전체화면 모드로 더 넓은 편집 공간을 활용하세요
                </p>
            </div>
        </div>
    </div>

    <!-- StackEdit.js 라이브러리 -->
    <script src="https://unpkg.com/stackedit-js@1.0.7/docs/lib/stackedit.min.js"></script>
    
    <script>
        class EmbeddedStackEdit {
            constructor() {
                this.stackedit = null;
                this.currentFile = null;
                this.isReady = false;
                
                this.sourceTextarea = document.getElementById('sourceTextarea');
                this.iframeContainer = document.querySelector('.stackedit-iframe-container');
                this.loadingOverlay = document.getElementById('loadingOverlay');
                
                this.setupEventListeners();
                this.initializeStackEdit();
            }
            
            async initializeStackEdit() {
                try {
                    this.updateStatus('초기화 중...');
                    
                    // StackEdit 인스턴스 생성
                    this.stackedit = new Stackedit();
                    
                    // 초기 파일 설정
                    this.currentFile = {
                        name: 'document.md',
                        content: {
                            text: this.sourceTextarea.value
                        },
                        properties: {
                            extensions: {
                                katex: { enabled: true },
                                mermaid: { enabled: true },
                                emoji: { enabled: true },
                                markdownExtra: { enabled: true }
                            }
                        }
                    };
                    
                    // StackEdit 열기 (iframe으로 임베딩)
                    this.stackedit.openFile(this.currentFile);
                    
                    // 이벤트 리스너 설정
                    this.setupStackEditEvents();
                    
                    // 로딩 완료 처리
                    setTimeout(() => {
                        this.hideLoading();
                        this.isReady = true;
                        this.updateStatus('편집 준비 완료');
                    }, 3000);
                    
                } catch (error) {
                    console.error('StackEdit 초기화 실패:', error);
                    this.showError('StackEdit을 로드할 수 없습니다.');
                }
            }
            
            setupStackEditEvents() {
                // 파일 변경 이벤트
                this.stackedit.on('fileChange', (file) => {
                    console.log('파일 변경됨:', file.name);
                    
                    // 소스 textarea 업데이트
                    this.sourceTextarea.value = file.content.text;
                    this.currentFile = file;
                    
                    // 상태 업데이트
                    this.updateFileName(file.name);
                    this.updateStatus('편집됨');
                    
                    // 자동 저장 표시
                    this.showAutoSaved();
                });
                
                // 에디터 준비 완료
                this.stackedit.on('ready', () => {
                    console.log('StackEdit 준비 완료');
                    this.isReady = true;
                    this.updateStatus('편집 가능');
                });
            }
            
            setupEventListeners() {
                // 툴바 버튼들
                document.getElementById('newFileBtn').addEventListener('click', () => this.newFile());
                document.getElementById('saveBtn').addEventListener('click', () => this.saveFile());
                document.getElementById('exportHtmlBtn').addEventListener('click', () => this.exportHTML());
                document.getElementById('exportMdBtn').addEventListener('click', () => this.exportMarkdown());
                document.getElementById('fullscreenBtn').addEventListener('click', () => this.toggleFullscreen());
                
                // 데모 파일 로드
                document.querySelectorAll('.demo-file').forEach(btn => {
                    btn.addEventListener('click', (e) => this.loadDemo(e.target.dataset.demo));
                });
                
                // 소스 textarea 변경 감지 (역방향 동기화)
                this.sourceTextarea.addEventListener('input', () => {
                    if (this.isReady && this.stackedit) {
                        // 디바운싱으로 너무 빈번한 업데이트 방지
                        clearTimeout(this.syncTimeout);
                        this.syncTimeout = setTimeout(() => {
                            this.syncToStackEdit();
                        }, 1000);
                    }
                });
            }
            
            syncToStackEdit() {
                if (this.stackedit && this.currentFile) {
                    const updatedFile = {
                        ...this.currentFile,
                        content: {
                            ...this.currentFile.content,
                            text: this.sourceTextarea.value
                        }
                    };
                    
                    // StackEdit에 변경사항 반영
                    this.stackedit.openFile(updatedFile);
                }
            }
            
            newFile() {
                const fileName = `new_document_${Date.now()}.md`;
                const newFile = {
                    name: fileName,
                    content: {
                        text: '# 새 문서\n\n여기에 내용을 작성하세요...\n'
                    },
                    properties: {
                        extensions: {
                            katex: { enabled: true },
                            mermaid: { enabled: true },
                            emoji: { enabled: true }
                        }
                    }
                };
                
                this.sourceTextarea.value = newFile.content.text;
                if (this.stackedit) {
                    this.stackedit.openFile(newFile);
                }
                this.updateFileName(fileName);
                this.updateStatus('새 파일 생성됨');
            }
            
            saveFile() {
                if (this.currentFile) {
                    // 브라우저 로컬 스토리지에 저장
                    const savedFiles = JSON.parse(localStorage.getItem('stackedit-files') || '[]');
                    const existingIndex = savedFiles.findIndex(f => f.name === this.currentFile.name);
                    
                    if (existingIndex >= 0) {
                        savedFiles[existingIndex] = this.currentFile;
                    } else {
                        savedFiles.push(this.currentFile);
                    }
                    
                    localStorage.setItem('stackedit-files', JSON.stringify(savedFiles));
                    this.updateStatus('저장됨');
                    this.showSaveConfirmation();
                }
            }
            
            exportHTML() {
                if (this.currentFile && this.currentFile.content.html) {
                    const html = this.generateCompleteHTML();
                    this.downloadFile(html, this.currentFile.name.replace('.md', '.html'), 'text/html');
                    this.updateStatus('HTML 내보내기 완료');
                } else {
                    alert('HTML 내용을 생성하기 위해 잠시 기다려주세요.');
                }
            }
            
            exportMarkdown() {
                if (this.currentFile) {
                    this.downloadFile(this.currentFile.content.text, this.currentFile.name, 'text/markdown');
                    this.updateStatus('Markdown 내보내기 완료');
                }
            }
            
            generateCompleteHTML() {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${this.currentFile.name}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 800px; 
            margin: 40px auto; 
            padding: 20px; 
            line-height: 1.6; 
            color: #333;
        }
        .katex-display { margin: 1.5em 0; }
        table { border-collapse: collapse; width: 100%; margin: 1em 0; }
        th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
        th { background-color: #f5f5f5; font-weight: 600; }
        code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        pre { background: #f5f5f5; padding: 1em; border-radius: 5px; overflow-x: auto; }
        blockquote { border-left: 4px solid #ddd; margin: 1em 0; padding: 0 1em; color: #666; }
        h1, h2, h3 { color: #2c3e50; }
        a { color: #3498db; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
${this.currentFile.content.html || '<p>HTML 내용을 생성 중입니다...</p>'}
</body>
</html>`;
            }
            
            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            toggleFullscreen() {
                const container = document.querySelector('.editor-container');
                if (!document.fullscreenElement) {
                    container.requestFullscreen().catch(err => {
                        console.error('전체화면 실패:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            }
            
            loadDemo(demoType) {
                const demos = {
                    welcome: `# 🎉 StackEdit에 오신 것을 환영합니다!

이것은 **실제 StackEdit**이 웹페이지에 임베딩된 에디터입니다.

## 🚀 주요 특징

- ✅ **실시간 동기화**: 오른쪽에서 편집하면 왼쪽 소스가 즉시 업데이트
- ✅ **완전한 StackEdit**: 모든 원본 기능 지원
- ✅ **KaTeX 수학**: $E = mc^2$ 완벽 지원
- ✅ **Mermaid 다이어그램**: 모든 차트 타입 지원
- ✅ **내보내기**: HTML, Markdown 파일 다운로드

## 🎯 시작하기

1. 오른쪽 에디터에서 자유롭게 편집해보세요
2. 왼쪽에서 실시간 소스 동기화를 확인하세요  
3. 다른 데모 버튼들도 클릭해보세요!

**즐거운 편집 되세요!** 🎨`,

                    math: `# 🧮 수학 공식 데모

## 기본 수식
인라인 수식: $E = mc^2$, $\pi r^2$, $\alpha + \beta = \gamma$

## 복잡한 수식
맥스웰 방정식:
$$\\nabla \\times \\vec{\\mathbf{B}} -\\, \\frac1c\\, \\frac{\\partial\\vec{\\mathbf{E}}}{\\partial t} = \\frac{4\\pi}{c}\\vec{\\mathbf{j}}$$

$$\\nabla \\cdot \\vec{\\mathbf{E}} = 4 \\pi \\rho$$

## 행렬과 벡터
$$\\begin{pmatrix}
\\cos\\theta & -\\sin\\theta \\\\
\\sin\\theta & \\cos\\theta
\\end{pmatrix}
\\begin{pmatrix}
x \\\\ y
\\end{pmatrix}
=
\\begin{pmatrix}
x\\cos\\theta - y\\sin\\theta \\\\
x\\sin\\theta + y\\cos\\theta
\\end{pmatrix}$$

## 적분과 극한
$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$

$$\\lim_{n \\to \\infty} \\left(1 + \\frac{1}{n}\\right)^n = e$$

## 화학 공식
$$\\ce{CO2 + C -> 2 CO}$$

$$\\ce{Hg^2+ ->[I-] HgI2 ->[I-] [Hg^{II}I4]^2-}$$`,

                    diagrams: `# 📊 다이어그램 데모

## 플로우차트
\`\`\`mermaid
graph TD
    A[프로젝트 시작] --> B{요구사항 분석}
    B -->|명확함| C[설계 단계]
    B -->|불명확함| D[추가 조사]
    D --> B
    C --> E[개발 시작]
    E --> F[테스트]
    F --> G{품질 검증}
    G -->|통과| H[배포]
    G -->|실패| E
    H --> I[완료]
\`\`\`

## 시퀀스 다이어그램
\`\`\`mermaid
sequenceDiagram
    participant 사용자
    participant 프론트엔드
    participant API서버
    participant 데이터베이스
    
    사용자->>프론트엔드: 로그인 요청
    프론트엔드->>API서버: 인증 요청
    API서버->>데이터베이스: 사용자 조회
    데이터베이스-->>API서버: 사용자 정보
    API서버-->>프론트엔드: JWT 토큰
    프론트엔드-->>사용자: 로그인 성공
\`\`\`

## 간트 차트
\`\`\`mermaid
gantt
    title 웹 프로젝트 일정
    dateFormat  YYYY-MM-DD
    section 기획
    요구사항 분석    :done, req, 2024-01-01, 2024-01-15
    UI/UX 설계      :done, design, after req, 20d
    section 개발
    프론트엔드 개발  :active, frontend, 2024-02-05, 45d
    백엔드 개발      :backend, 2024-02-10, 40d
    section 테스트
    통합 테스트      :test, after frontend, 15d
    배포 준비        :deploy, after test, 10d
\`\`\``,

                    tables: `# 📋 고급 표 데모

## 기본 표
| 기능 | StackEdit | 다른 에디터 | 점수 |
|------|-----------|-------------|------|
| KaTeX 지원 | ✅ 완전 지원 | ⚠️ 제한적 | 10/10 |
| Mermaid | ✅ 모든 차트 | ❌ 미지원 | 10/10 |
| 실시간 동기화 | ✅ 완벽 | ❌ 없음 | 10/10 |
| 클라우드 동기화 | ✅ 지원 | ⚠️ 제한적 | 9/10 |

## 정렬된 표
| 왼쪽 정렬 | 가운데 정렬 | 오른쪽 정렬 |
|:----------|:----------:|----------:|
| 텍스트 | 중앙 | 100 |
| 긴 내용입니다 | 짧음 | 1,234 |
| A | B | 99.9% |

## 수식이 포함된 표
| 공식 | 이름 | 응용 분야 |
|------|------|-----------|
| $E = mc^2$ | 질량-에너지 등가성 | 상대성이론 |
| $F = ma$ | 뉴턴의 제2법칙 | 고전역학 |
| $V
